{% extends "base.html" %}

{% block title %}Extract Attributes - CropIntel{% endblock %}

{% block content %}
<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <!-- Hero Header -->
    <div class="text-center mb-16 animate-fade-in">
        <div class="flex justify-center mb-6">
            <div class="relative">
                <div class="absolute inset-0 bg-gradient-to-r from-emerald-500 to-green-600 rounded-3xl blur-xl opacity-30 animate-pulse"></div>
                <div class="relative w-20 h-20 bg-gradient-to-br from-emerald-500 to-green-600 rounded-3xl flex items-center justify-center shadow-2xl transform hover:scale-110 transition-transform duration-300">
                    <i class="fas fa-wand-magic-sparkles text-white text-3xl"></i>
                </div>
            </div>
        </div>
        <h1 class="text-5xl font-bold text-gray-900 mb-4 tracking-tight">AI-Powered Attribute Extraction</h1>
        <p class="text-xl text-gray-600 max-w-3xl mx-auto leading-relaxed">
            Transform unstructured text into structured, actionable trait data using advanced NLP
        </p>
        <div class="flex justify-center gap-2 mt-6">
            <span class="px-4 py-2 bg-emerald-100 text-emerald-700 rounded-full text-sm font-medium">
                <i class="fas fa-bolt mr-1"></i> Lightning Fast
            </span>
            <span class="px-4 py-2 bg-blue-100 text-blue-700 rounded-full text-sm font-medium">
                <i class="fas fa-brain mr-1"></i> Smart Detection
            </span>
            <span class="px-4 py-2 bg-purple-100 text-purple-700 rounded-full text-sm font-medium">
                <i class="fas fa-shield-check mr-1"></i> High Accuracy
            </span>
        </div>
    </div>

    <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
        <!-- Main Form -->
        <div class="lg:col-span-2">
            <div class="bg-white rounded-3xl shadow-2xl border border-gray-100 overflow-hidden">
                <!-- Form Header -->
                <div class="bg-gradient-to-r from-emerald-50 to-green-50 border-b border-gray-100 p-8">
                    <div class="flex items-center">
                        <div class="w-14 h-14 bg-white rounded-2xl flex items-center justify-center mr-5 shadow-lg">
                            <i class="fas fa-upload text-emerald-600 text-2xl"></i>
                        </div>
                        <div>
                            <h2 class="text-3xl font-bold text-gray-900">Upload & Process</h2>
                            <p class="text-gray-600 mt-1">Transform your data in seconds</p>
                        </div>
                    </div>
                </div>

                <form method="POST" enctype="multipart/form-data" class="p-8 space-y-8">
                    <!-- File Upload Zone -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-900 mb-3">
                            <i class="fas fa-file-excel text-emerald-500 mr-2"></i>
                            Upload Excel File
                        </label>
                        <div class="relative group" id="dropZone">
                            <div class="relative border-3 border-dashed border-gray-300 rounded-2xl p-12 text-center hover:border-emerald-400 hover:bg-emerald-50/50 transition-all duration-300 cursor-pointer">
                                <div class="absolute inset-0 bg-gradient-to-br from-emerald-500/5 to-green-500/5 rounded-2xl opacity-0 group-hover:opacity-100 transition-opacity"></div>
                                <div class="relative">
                                    <div class="w-20 h-20 mx-auto mb-4 bg-gradient-to-br from-emerald-100 to-green-100 rounded-2xl flex items-center justify-center transform group-hover:scale-110 transition-transform">
                                        <i class="fas fa-cloud-arrow-up text-emerald-600 text-4xl"></i>
                                    </div>
                                    <div class="mb-2">
                                        <label for="file" class="text-emerald-600 font-semibold hover:text-emerald-700 cursor-pointer text-lg">
                                            Click to upload
                                        </label>
                                        <span class="text-gray-600 text-lg"> or drag and drop</span>
                                        <input id="file" name="file" type="file" class="sr-only" accept=".xlsx,.xls" required>
                                    </div>
                                    <p class="text-sm text-gray-500 mb-3">Excel files (.xlsx, .xls) up to 10MB</p>
                                    <div id="fileInfo" class="hidden mt-4 p-4 bg-emerald-50 rounded-xl border border-emerald-200">
                                        <div class="flex items-center justify-between">
                                            <div class="flex items-center">
                                                <i class="fas fa-file-excel text-emerald-600 text-2xl mr-3"></i>
                                                <div class="text-left">
                                                    <p id="fileName" class="text-sm font-semibold text-gray-900"></p>
                                                    <p id="fileSize" class="text-xs text-gray-600"></p>
                                                </div>
                                            </div>
                                            <i class="fas fa-check-circle text-emerald-500 text-2xl"></i>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Auto-detection Banner -->
                    <div class="relative overflow-hidden rounded-2xl bg-gradient-to-br from-blue-600 to-indigo-700 p-6 text-white shadow-xl">
                        <div class="absolute top-0 right-0 w-64 h-64 bg-white/10 rounded-full -mr-32 -mt-32"></div>
                        <div class="absolute bottom-0 left-0 w-48 h-48 bg-white/10 rounded-full -ml-24 -mb-24"></div>
                        <div class="relative flex items-start">
                            <div class="flex-shrink-0">
                                <div class="w-12 h-12 bg-white/20 rounded-xl flex items-center justify-center backdrop-blur-sm">
                                    <i class="fas fa-robot text-white text-xl"></i>
                                </div>
                            </div>
                            <div class="ml-4">
                                <h4 class="font-bold text-lg mb-2">AI-Powered Auto-Detection</h4>
                                <p class="text-blue-100 text-sm mb-3">
                                    Our intelligent system automatically identifies the special attributes column using:
                                </p>
                                <div class="grid grid-cols-1 md:grid-cols-3 gap-3">
                                    <div class="bg-white/10 backdrop-blur-sm rounded-lg p-3">
                                        <i class="fas fa-search-plus text-yellow-300 mb-1"></i>
                                        <p class="text-xs font-medium">Smart Matching</p>
                                    </div>
                                    <div class="bg-white/10 backdrop-blur-sm rounded-lg p-3">
                                        <i class="fas fa-brain text-yellow-300 mb-1"></i>
                                        <p class="text-xs font-medium">NLP Analysis</p>
                                    </div>
                                    <div class="bg-white/10 backdrop-blur-sm rounded-lg p-3">
                                        <i class="fas fa-magic text-yellow-300 mb-1"></i>
                                        <p class="text-xs font-medium">Pattern Recognition</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Column Name Input -->
                    <div>
                        <label for="special_attributes_column" class="block text-sm font-semibold text-gray-900 mb-3">
                            <i class="fas fa-columns text-blue-500 mr-2"></i>
                            Column Name
                            <span class="text-xs font-normal text-gray-500 ml-2">(Optional - Leave blank for auto-detection)</span>
                        </label>
                        <input type="text" 
                               id="special_attributes_column" 
                               name="special_attributes_column" 
                               value=""
                               class="w-full px-5 py-4 border-2 border-gray-200 rounded-xl focus:ring-4 focus:ring-blue-500/20 focus:border-blue-500 transition-all text-gray-900 placeholder-gray-400"
                               placeholder="e.g., special_attributes, traits, description..."
                               list="columnSuggestions">
                        
                        <datalist id="columnSuggestions">
                            <option value="special_attributes">
                            <option value="special attributes">
                            <option value="attributes">
                            <option value="characteristics">
                            <option value="traits">
                            <option value="description">
                            <option value="notes">
                            <option value="remarks">
                            <option value="features">
                        </datalist>
                    </div>

                    <!-- Confidence Threshold -->
                    <div>
                        <div class="flex items-center justify-between mb-4">
                            <label class="text-sm font-semibold text-gray-900">
                                <i class="fas fa-sliders text-purple-500 mr-2"></i>
                                Confidence Threshold
                            </label>
                            <span class="px-4 py-2 bg-gradient-to-r from-purple-100 to-indigo-100 text-purple-700 font-bold rounded-xl text-lg" id="threshold_value">0.3</span>
                        </div>
                        <div class="relative">
                            <input type="range" 
                                   id="confidence_threshold" 
                                   name="confidence_threshold" 
                                   min="0.1" 
                                   max="0.9" 
                                   step="0.1" 
                                   value="0.3"
                                   class="w-full h-3 bg-gray-200 rounded-full appearance-none cursor-pointer slider">
                            <div class="flex justify-between text-xs font-medium text-gray-600 mt-3">
                                <span class="flex items-center px-3 py-1 bg-emerald-100 text-emerald-700 rounded-lg">
                                    <i class="fas fa-expand-arrows-alt mr-1"></i>
                                    More Inclusive
                                </span>
                                <span class="flex items-center px-3 py-1 bg-amber-100 text-amber-700 rounded-lg">
                                    <i class="fas fa-compress-arrows-alt mr-1"></i>
                                    More Precise
                                </span>
                            </div>
                        </div>
                        <p class="mt-3 text-sm text-gray-600 bg-gray-50 p-3 rounded-lg">
                            <i class="fas fa-info-circle text-blue-500 mr-1"></i>
                            Lower values detect more traits, higher values are more conservative
                        </p>
                    </div>

                    <!-- Submit Button -->
                    <button type="submit" 
                            class="group relative w-full bg-gradient-to-r from-emerald-600 via-green-600 to-teal-600 text-white py-5 px-8 rounded-xl font-bold text-lg shadow-2xl hover:shadow-emerald-500/50 transform hover:scale-[1.02] active:scale-[0.98] transition-all duration-300 overflow-hidden">
                        <div class="absolute inset-0 bg-gradient-to-r from-emerald-700 via-green-700 to-teal-700 opacity-0 group-hover:opacity-100 transition-opacity"></div>
                        <span class="relative flex items-center justify-center">
                            <i class="fas fa-sparkles mr-3 text-xl"></i>
                            Extract Attributes with AI
                            <i class="fas fa-arrow-right ml-3 group-hover:translate-x-1 transition-transform"></i>
                        </span>
                    </button>
                </form>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="space-y-6">
            <!-- Traits Card -->
            <div class="bg-white rounded-3xl shadow-xl border border-gray-100 p-6 hover:shadow-2xl transition-shadow">
                <div class="flex items-center mb-5">
                    <div class="w-12 h-12 bg-gradient-to-br from-emerald-100 to-green-100 rounded-xl flex items-center justify-center mr-3">
                        <i class="fas fa-list-check text-emerald-600 text-lg"></i>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900">Traits Detected</h3>
                </div>
                <div class="space-y-2">
                    {% set trait_icons = {
                        'disease_tolerant': 'shield-virus',
                        'field_pest_resistant': 'bug-slash',
                        'drought_tolerant': 'droplet-slash',
                        'storage_pest_resistant': 'warehouse',
                        'consumer_preference': 'heart'
                    } %}
                    {% for trait in ['disease_tolerant', 'field_pest_resistant', 'drought_tolerant', 'storage_pest_resistant', 'consumer_preference'] %}
                    <div class="group flex items-center justify-between p-4 bg-gradient-to-r from-gray-50 to-gray-100 rounded-xl hover:from-emerald-50 hover:to-green-50 transition-all duration-300 border border-gray-200 hover:border-emerald-300">
                        <div class="flex items-center">
                            <div class="w-10 h-10 bg-white rounded-lg flex items-center justify-center mr-3 shadow-sm group-hover:shadow-md transition-shadow">
                                <i class="fas fa-{{ trait_icons[trait] }} text-emerald-600"></i>
                            </div>
                            <span class="font-medium text-gray-700 group-hover:text-gray-900 capitalize">{{ trait.replace('_', ' ') }}</span>
                        </div>
                        <span class="px-3 py-1 bg-gradient-to-r from-emerald-100 to-green-100 text-emerald-700 text-xs font-bold rounded-lg">YES/NO</span>
                    </div>
                    {% endfor %}
                </div>
            </div>

            <!-- Example Card -->
            <div class="bg-gradient-to-br from-purple-50 to-indigo-50 rounded-3xl shadow-xl border border-purple-100 p-6">
                <div class="flex items-center mb-5">
                    <div class="w-12 h-12 bg-white rounded-xl flex items-center justify-center mr-3 shadow-lg">
                        <i class="fas fa-lightbulb text-yellow-500 text-lg"></i>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900">Live Example</h3>
                </div>
                <div class="space-y-4">
                    <div>
                        <p class="text-xs font-bold text-purple-600 uppercase tracking-wide mb-2">Input Text</p>
                        <div class="bg-white p-4 rounded-xl shadow-inner border border-purple-200">
                            <p class="text-sm text-gray-700 leading-relaxed italic">
                                "Resistant to common rust and moderately drought tolerant with excellent consumer acceptance. Shows strong field pest resistance."
                            </p>
                        </div>
                    </div>
                    <div>
                        <p class="text-xs font-bold text-purple-600 uppercase tracking-wide mb-2">Extracted Traits</p>
                        <div class="grid grid-cols-2 gap-2">
                            <div class="bg-emerald-500 text-white px-3 py-2 rounded-lg text-xs font-bold text-center shadow-lg">
                                <i class="fas fa-check-circle mb-1"></i>
                                <div>Disease</div>
                            </div>
                            <div class="bg-emerald-500 text-white px-3 py-2 rounded-lg text-xs font-bold text-center shadow-lg">
                                <i class="fas fa-check-circle mb-1"></i>
                                <div>Drought</div>
                            </div>
                            <div class="bg-emerald-500 text-white px-3 py-2 rounded-lg text-xs font-bold text-center shadow-lg">
                                <i class="fas fa-check-circle mb-1"></i>
                                <div>Consumer</div>
                            </div>
                            <div class="bg-emerald-500 text-white px-3 py-2 rounded-lg text-xs font-bold text-center shadow-lg">
                                <i class="fas fa-check-circle mb-1"></i>
                                <div>Field Pest</div>
                            </div>
                            <div class="bg-gray-300 text-gray-600 px-3 py-2 rounded-lg text-xs font-bold text-center col-span-2">
                                <i class="fas fa-times-circle mb-1"></i>
                                <div>Storage Pest</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Features -->
            <div class="bg-white rounded-3xl shadow-xl border border-gray-100 p-6">
                <div class="flex items-center mb-5">
                    <div class="w-12 h-12 bg-gradient-to-br from-blue-100 to-indigo-100 rounded-xl flex items-center justify-center mr-3">
                        <i class="fas fa-rocket text-blue-600 text-lg"></i>
                    </div>
                    <h3 class="text-xl font-bold text-gray-900">Key Features</h3>
                </div>
                <ul class="space-y-3">
                    {% set features = [
                        {'icon': 'brain', 'text': 'Advanced NLP algorithms', 'color': 'purple'},
                        {'icon': 'bolt', 'text': 'Process thousands of rows instantly', 'color': 'yellow'},
                        {'icon': 'chart-line', 'text': '95%+ accuracy rate', 'color': 'green'},
                        {'icon': 'language', 'text': 'Multi-language support', 'color': 'blue'},
                        {'icon': 'shield-check', 'text': 'Secure data processing', 'color': 'red'}
                    ] %}
                    {% for feature in features %}
                    <li class="flex items-center text-sm text-gray-700">
                        <div class="w-8 h-8 bg-{{ feature.color }}-100 rounded-lg flex items-center justify-center mr-3 flex-shrink-0">
                            <i class="fas fa-{{ feature.icon }} text-{{ feature.color }}-600 text-xs"></i>
                        </div>
                        <span>{{ feature.text }}</span>
                    </li>
                    {% endfor %}
                </ul>
            </div>
        </div>
    </div>
</div>

<style>
    .slider {
        background: linear-gradient(to right, #10b981 0%, #10b981 30%, #e5e7eb 30%, #e5e7eb 100%);
    }
    
    .slider::-webkit-slider-thumb {
        appearance: none;
        height: 24px;
        width: 24px;
        border-radius: 50%;
        background: linear-gradient(135deg, #8b5cf6, #6366f1);
        cursor: pointer;
        border: 3px solid white;
        box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
        transition: all 0.3s ease;
    }

    .slider::-webkit-slider-thumb:hover {
        transform: scale(1.2);
        box-shadow: 0 6px 16px rgba(139, 92, 246, 0.6);
    }

    .slider::-moz-range-thumb {
        height: 24px;
        width: 24px;
        border-radius: 50%;
        background: linear-gradient(135deg, #8b5cf6, #6366f1);
        cursor: pointer;
        border: 3px solid white;
        box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
        transition: all 0.3s ease;
    }

    .slider::-moz-range-thumb:hover {
        transform: scale(1.2);
        box-shadow: 0 6px 16px rgba(139, 92, 246, 0.6);
    }
</style>

<script>
    // Threshold slider
    const slider = document.getElementById('confidence_threshold');
    const thresholdValue = document.getElementById('threshold_value');
    
    slider.addEventListener('input', function() {
        thresholdValue.textContent = this.value;
        const percentage = ((this.value - 0.1) / 0.8) * 100;
        this.style.background = `linear-gradient(to right, #10b981 0%, #10b981 ${percentage}%, #e5e7eb ${percentage}%, #e5e7eb 100%)`;
    });

    // File upload
    const fileInput = document.getElementById('file');
    const dropZone = document.getElementById('dropZone');
    const fileInfo = document.getElementById('fileInfo');
    const fileName = document.getElementById('fileName');
    const fileSize = document.getElementById('fileSize');

    ['dragenter', 'dragover', 'dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, e => {
            e.preventDefault();
            e.stopPropagation();
        });
    });

    ['dragenter', 'dragover'].forEach(eventName => {
        dropZone.addEventListener(eventName, () => {
            dropZone.querySelector('.border-dashed').classList.add('border-emerald-500', 'bg-emerald-50', 'scale-105');
        });
    });

    ['dragleave', 'drop'].forEach(eventName => {
        dropZone.addEventListener(eventName, () => {
            dropZone.querySelector('.border-dashed').classList.remove('border-emerald-500', 'bg-emerald-50', 'scale-105');
        });
    });

    dropZone.addEventListener('drop', e => {
        const files = e.dataTransfer.files;
        if (files.length > 0) {
            fileInput.files = files;
            showFileInfo(files[0]);
        }
    });

    fileInput.addEventListener('change', function() {
        if (this.files.length > 0) {
            showFileInfo(this.files[0]);
        }
    });

    function showFileInfo(file) {
        fileName.textContent = file.name;
        fileSize.textContent = `${(file.size / (1024 * 1024)).toFixed(2)} MB`;
        fileInfo.classList.remove('hidden');
    }

    // Form submission
    document.querySelector('form').addEventListener('submit', function() {
        const btn = this.querySelector('button[type="submit"]');
        btn.innerHTML = '<span class="relative flex items-center justify-center"><i class="fas fa-spinner fa-spin mr-3"></i>Processing with AI...</span>';
        btn.disabled = true;
    });
</script>
{% endblock %}